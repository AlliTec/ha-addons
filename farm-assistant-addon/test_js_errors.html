<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Error Test</title>
</head>
<body>
    <h1>JavaScript Error Detection Test</h1>
    <div id="results"></div>
    
    <script src="http://localhost:8000/static/script.js"></script>
    <script>
        const results = document.getElementById('results');
        
        function logResult(test, status, message) {
            results.innerHTML += `<p><strong>${test}:</strong> <span style="color: ${status === 'pass' ? 'green' : 'red'}">${status.toUpperCase()}</span> - ${message}</p>`;
        }
        
        // Override console.error to catch errors
        const originalError = console.error;
        const errors = [];
        console.error = function(...args) {
            errors.push(args.join(' '));
            originalError.apply(console, args);
        };
        
        // Test after script loads
        setTimeout(() => {
            // Test 1: Check if populateFromVIN is defined
            if (typeof populateFromVIN !== 'undefined') {
                logResult('populateFromVIN defined', 'pass', 'Function is available');
            } else {
                logResult('populateFromVIN defined', 'fail', 'Function is not defined');
            }
            
            // Test 2: Check if populateVehicleBodyTypes is defined
            if (typeof populateVehicleBodyTypes !== 'undefined') {
                logResult('populateVehicleBodyTypes defined', 'pass', 'Function is available');
                
                // Test 3: Try to call populateVehicleBodyTypes to check for const assignment errors
                try {
                    // This should not throw "Assignment to constant variable" error
                    populateVehicleBodyTypes('Toyota', 'Coaster', '2000').then(() => {
                        logResult('populateVehicleBodyTypes execution', 'pass', 'No const assignment errors');
                    }).catch(err => {
                        if (err.message.includes('Assignment to constant variable')) {
                            logResult('populateVehicleBodyTypes execution', 'fail', 'Const assignment error: ' + err.message);
                        } else {
                            logResult('populateVehicleBodyTypes execution', 'pass', 'Network error expected (API call): ' + err.message);
                        }
                    });
                } catch (err) {
                    if (err.message.includes('Assignment to constant variable')) {
                        logResult('populateVehicleBodyTypes execution', 'fail', 'Const assignment error: ' + err.message);
                    } else {
                        logResult('populateVehicleBodyTypes execution', 'pass', 'Other error (not const assignment): ' + err.message);
                    }
                }
            } else {
                logResult('populateVehicleBodyTypes defined', 'fail', 'Function is not defined');
            }
            
            // Test 4: Check for any console errors
            setTimeout(() => {
                if (errors.length === 0) {
                    logResult('Console errors', 'pass', 'No console errors detected');
                } else {
                    logResult('Console errors', 'fail', `Found ${errors.length} errors: ${errors.join('; ')}`);
                }
            }, 2000);
            
        }, 1000);
    </script>
</body>
</html>